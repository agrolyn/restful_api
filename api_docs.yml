swagger: "2.0"
info:
  title: "API Documentation"
  version: "1.0"
  description: "API Documentation For AGROLYN Apps."

tags:
  - name: "authentication"
    description: "Endpoints related to authentication and authorization"
  - name: "article"
    description: "Endpoints related to articles"
  - name: "recipe"
    description: "Endpoints related to recipes"
  - name: "profile"
    description: "Endpoints related to user profile"
  - name: "community"
    description: "Endpoints related to community"

paths:
  /refresh-token/:
    post:
      tags:
        - "authentication"
      summary: "Obtain a new access token using refresh token"
      description: "Use this endpoint to get a new access token without logging in again. Requires a valid refresh token in the Authorization header."
      parameters:
        - in: header
          name: Authorization
          required: true
          description: "Bearer token format with the refresh token (e.g., 'Bearer <refresh_token>')"
          schema:
            type: string
      responses:
        200:
          description: "Successfully obtained new access token"
          schema:
            type: object
            properties:
              access_token:
                type: string
                description: "New JWT access token for authenticated requests"
        401:
          description: "Invalid or expired refresh token"
        422:
          description: "Missing or invalid Authorization header format"

  /register/:
    post:
      tags:
        - "authentication"
      summary: "Register a new user"
      consumes:
        - application/json
      parameters:
        - in: body
          name: user
          required: true
          schema:
            type: object
            properties:
              name:
                type: string
              email:
                type: string
              address:
                type: string
              phone_number:
                type: string
              password:
                type: string
              roles_id:
                type: integer
      responses:
        201:
          description: "User registered successfully. Check email to confirm account."
        400:
          description: "Email already exists"

  /confirm/{token}/:
    get:
      tags:
        - "authentication"
      summary: "Confirm user's email"
      parameters:
        - name: token
          in: path
          required: true
          type: string
          description: "The confirmation token sent via email"
      responses:
        200:
          description: "Email verified successfully"
        400:
          description: "Invalid or expired confirmation link"

  /login/:
    post:
      tags:
        - "authentication"
      summary: "Login user and obtain JWT tokens (access and refresh)"
      consumes:
        - application/json
      parameters:
        - in: body
          name: credentials
          required: true
          schema:
            type: object
            properties:
              email:
                type: string
                description: "User's email address"
              password:
                type: string
                description: "User's password"
      responses:
        200:
          description: "Logged in successfully with access and refresh tokens provided"
          schema:
            type: object
            properties:
              access_token:
                type: string
                description: "JWT access token for authenticated requests"
              refresh_token:
                type: string
                description: "JWT refresh token for obtaining new access tokens"
              id:
                type: integer
                description: "User's unique ID"
              email:
                type: string
                description: "User's email address"
              name:
                type: string
                description: "User's name"
              address:
                type: string
                description: "User's address"
              phone_number:
                type: string
                description: "User's phone number"
              img_profile:
                type: string
                description: "URL to user's profile image"
              roles_id:
                type: integer
                description: "User's role ID"
        401:
          description: "Invalid credentials"
        403:
          description: "Email not verified"

  /forgot_password/:
    post:
      tags:
        - "authentication"
      summary: "Request password reset link"
      consumes:
        - application/json
      parameters:
        - in: body
          name: email
          required: true
          schema:
            type: object
            properties:
              email:
                type: string
      responses:
        200:
          description: "Password reset email sent"
        404:
          description: "Email not found"

  /reset_password/{token}/:
    get:
      tags:
        - "authentication"
      summary: "Confirm user's email reset password"
      parameters:
        - name: token
          in: path
          required: true
          type: string
          description: "The confirmation token reset password sent via email"
      responses:
        200:
          description: "Email reset password verified successfully"
        400:
          description: "Invalid or expired confirmation link"
    post:
      tags:
        - "authentication"
      summary: "Reset user password"
      consumes:
        - application/json
      parameters:
        - name: token
          in: path
          required: true
          type: string
          description: "The reset token sent via email"
        - in: body
          name: password
          required: true
          schema:
            type: object
            properties:
              new_password:
                type: string
      responses:
        200:
          description: "Password reset successfully"
        400:
          description: "Invalid or expired reset link"
        404:
          description: "User not found"

  /logout/:
    post:
      tags:
        - "authentication"
      summary: "Logout user and invalidate session"
      parameters:
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token for authorization (e.g., 'Bearer <access_token>')"
      responses:
        200:
          description: "Logged out successfully"

  /articles/:
    get:
      tags:
        - "article"
      summary: "Get all articles"
      parameters:
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token for authorization (e.g., 'Bearer <access_token>')"
      responses:
        200:
          description: "A list of articles"
          schema:
            type: array
            items:
              type: object
              properties:
                id:
                  type: integer
                  description: "The article ID"
                title:
                  type: string
                  description: "The title of the article"
                thumbnail:
                  type: string
                  description: "URL of the article thumbnail"
                description:
                  type: string
                  description: "A brief description of the article"
                location:
                  type: string
                  description: "The location related to the article"
                released_date:
                  type: string
                  format: date
                  description: "The release date of the article"

  /articles/{id}/:
    get:
      tags:
        - "article"
      summary: "Get article detail"
      parameters:
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token for authorization (e.g., 'Bearer <access_token>')"
        - name: id
          in: path
          required: true
          type: integer
          description: "The ID of the article to retrieve"
      responses:
        200:
          description: "Article details"
          schema:
            type: object
            properties:
              id:
                type: integer
                description: "The article ID"
              title:
                type: string
                description: "The title of the article"
              thumbnail:
                type: string
                description: "URL of the article thumbnail"
              description:
                type: string
                description: "A brief description of the article"
              location:
                type: string
                description: "The location related to the article"
              released_date:
                type: string
                format: date
                description: "The release date of the article"
        404:
          description: "Article not found"

  /recipes/:
    get:
      tags:
        - "recipe"
      summary: "Get all recipes"
      parameters:
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token for authorization (e.g., 'Bearer <access_token>')"
      responses:
        200:
          description: "A list of recipes"
          schema:
            type: array
            items:
              type: object
              properties:
                id:
                  type: integer
                  description: "The recipe ID"
                title:
                  type: string
                  description: "The title of the recipe"
                img_recipe:
                  type: string
                  description: "URL of the recipe image"
                ingredients:
                  type: string
                  description: "The ingredients needed for the recipe"
                steps:
                  type: string
                  description: "The instructions for preparing the recipe"

  /recipes/{id}/:
    get:
      tags:
        - "recipe"
      summary: "Get recipe detail"
      parameters:
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token for authorization (e.g., 'Bearer <access_token>')"
        - name: id
          in: path
          required: true
          type: integer
          description: "The ID of the recipe to retrieve"
      responses:
        200:
          description: "Recipe details"
          schema:
            type: object
            properties:
              id:
                type: integer
                description: "The recipe ID"
              title:
                type: string
                description: "The title of the recipe"
              img_recipe:
                type: string
                description: "URL of the recipe image"
              ingredients:
                type: string
                description: "The ingredients needed for the recipe"
              steps:
                type: string
                description: "The instructions for preparing the recipe"
        404:
          description: "Recipe not found"
  /edit-profile/:
    put:
      tags:
        - "profile"
      summary: "Edit user profile"
      description: "Endpoint for updating user's profile information."
      consumes:
        - application/json
      parameters:
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token for authorization (e.g., 'Bearer <access_token>')"
        - in: body
          name: profile
          required: true
          schema:
            type: object
            properties:
              name:
                type: string
                description: "User's updated name"
              address:
                type: string
                description: "User's updated address"
              phone_number:
                type: string
                description: "User's updated phone number"
      responses:
        200:
          description: "Profile updated successfully"
        400:
          description: "No valid fields to update"
        404:
          description: "User not found"
        401:
          description: "Unauthorized access"
  /community/questions/:
    get:
      tags:
        - "community"
      summary: "Get all community questions"
      description: "Retrieve all questions from the community, including user details and metadata. Requires a valid JWT token."
      parameters:
        - name: Authorization
          in: header
          required: true
          schema:
            type: string
          description: "JWT token for authorization (e.g., 'Bearer <access_token>')"
      responses:
        200:
          description: "A list of community questions"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: "Status message"
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          description: "The ID of the question"
                        username:
                          type: string
                          description: "The name of the user who posted the question"
                        user_profile:
                          type: string
                          description: "URL of the user's profile picture"
                        question_type:
                          type: string
                          description: "The type of the plant related to the question"
                        title_question:
                          type: string
                          description: "The title of the question"
                        like_num:
                          type: integer
                          description: "Number of likes the question has received"
                        question_thumbnail:
                          type: string
                          description: "URL of the question's thumbnail image"
                        number_of_answer:
                          type: integer
                          description: "Number of answers for the question"
                        released_date:
                          type: string
                          format: date-time
                          description: "The release date of the question"
        401:
          description: "Unauthorized - Invalid or missing JWT token"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: "Error message indicating authorization failure"
        500:
          description: "An error occurred while fetching questions"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: "Error message"
                  error:
                    type: string
                    description: "Details about the error"
  /community/questions/{id}/:
    get:
      tags:
        - "community"
      summary: "Get details of a specific question"
      description: "Retrieve detailed information about a specific community question and its answers. Requires a valid JWT token."
      parameters:
        - name: Authorization
          in: header
          required: true
          schema:
            type: string
          description: "JWT token for authorization (e.g., 'Bearer <access_token>')"
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: "The ID of the question to retrieve"
      responses:
        200:
          description: "Details of the question and its answers"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: "Status message"
                  data:
                    type: object
                    properties:
                      question_detail:
                        type: object
                        properties:
                          id:
                            type: integer
                            description: "The ID of the question"
                          username:
                            type: string
                            description: "The name of the user who posted the question"
                          user_profile:
                            type: string
                            description: "URL of the user's profile picture"
                          question_type:
                            type: string
                            description: "The type of the plant related to the question"
                          title_question:
                            type: string
                            description: "The title of the question"
                          description:
                            type: string
                            description: "The content of the question"
                          like_num:
                            type: integer
                            description: "Number of likes the question has received"
                          question_thumbnail:
                            type: string
                            description: "URL of the question's thumbnail image"
                          number_of_answer:
                            type: integer
                            description: "Number of answers for the question"
                          released_date:
                            type: string
                            format: date-time
                            description: "The release date of the question"
                      list_answer:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: "The ID of the answer"
                            username:
                              type: string
                              description: "The name of the user who posted the answer"
                            user_profile:
                              type: string
                              description: "URL of the user's profile picture"
                            answer:
                              type: string
                              description: "The content of the answer"
                            like_num:
                              type: integer
                              description: "Number of likes the answer has received"
                            released_date:
                              type: string
                              format: date-time
                              description: "The release date of the answer"
        401:
          description: "Unauthorized - Invalid or missing JWT token"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: "Error message indicating authorization failure"
        404:
          description: "The question with the specified ID was not found"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: "Error message"

  /community/questions/filters/{filter_name}/:
    get:
      tags:
        - "community"
      summary: "Get filtered community questions"
      description: >
        Retrieve community questions based on specific filters. 
        Supports filters such as:
        - `"umum"`: General questions
        - `"padi"`: Rice-related questions
        - `"jagung"`: Corn-related questions
        - `"answerme"`: Questions asked by the logged-in user.
        Requires a valid JWT token.
      parameters:
        - name: Authorization
          in: header
          required: true
          schema:
            type: string
          description: "JWT token for authorization (e.g., 'Bearer <access_token>')"
        - name: filter_name
          in: path
          required: true
          schema:
            type: string
            enum:
              - umum
              - padi
              - jagung
              - answerme
          description: >
            The name of the filter to apply:
            - `umum`: General questions
            - `padi`: Rice-related questions
            - `jagung`: Corn-related questions
            - `answerme`: Questions asked by the logged-in user.
      responses:
        200:
          description: "Filtered community questions"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: "Status message"
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          description: "The ID of the question"
                        username:
                          type: string
                          description: "The name of the user who posted the question"
                        user_profile:
                          type: string
                          description: "URL of the user's profile picture"
                        question_type:
                          type: string
                          description: "The type of the plant related to the question"
                        title_question:
                          type: string
                          description: "The title of the question"
                        like_num:
                          type: integer
                          description: "Number of likes the question has received"
                        question_thumbnail:
                          type: string
                          description: "URL of the question's thumbnail image"
                        number_of_answer:
                          type: integer
                          description: "Number of answers for the question"
                        released_date:
                          type: string
                          format: date-time
                          description: "The release date of the question"
        401:
          description: "Unauthorized - Invalid or missing JWT token"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: "Error message indicating authorization failure"
        500:
          description: "An error occurred while fetching filtered questions"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: "Error message"
                  error:
                    type: string
                    description: "Details about the error"

  /community/questions/{id}/like/:
    post:
      tags:
        - "community"
      summary: "Sukai (like) pertanyaan komunitas"
      description: "Menambahkan jumlah like pada pertanyaan komunitas berdasarkan ID pertanyaan."
      parameters:
        - name: id
          in: path
          required: true
          type: integer
          description: "ID dari pertanyaan komunitas yang ingin disukai (like)."
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token untuk otorisasi (e.g., 'Bearer <access_token>')."
      responses:
        200:
          description: "Berhasil menyukai pertanyaan komunitas."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Sukses menyukai (like) pertanyaan komunitas."
        400:
          description: "Pertanyaan tidak ditemukan."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Gagal menyukai (like) pertanyaan komunitas."
        500:
          description: "Kesalahan server internal."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Error terjadi"
              error:
                type: string
                example: "Database connection failed."

  /community/questions/{id}/dislike/:
    post:
      tags:
        - "community"
      summary: "Tidak menyukai (dislike) pertanyaan komunitas"
      description: "Mengurangi jumlah like pada pertanyaan komunitas berdasarkan ID pertanyaan."
      parameters:
        - name: id
          in: path
          required: true
          type: integer
          description: "ID dari pertanyaan komunitas yang ingin tidak disukai (dislike)."
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token untuk otorisasi (e.g., 'Bearer <access_token>')."
      responses:
        200:
          description: "Berhasil tidak menyukai pertanyaan komunitas."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Sukses tidak menyukai (dislike) pertanyaan komunitas."
        400:
          description: "Pertanyaan tidak ditemukan atau like bernilai 0."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Gagal tidak menyukai (dislike) pertanyaan komunitas."
        500:
          description: "Kesalahan server internal."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Error terjadi"
              error:
                type: string
                example: "Database connection failed."

  /community/answer/{id}/like/:
    post:
      tags:
        - "community"
      summary: "Sukai (like) jawaban komunitas"
      description: "Menambahkan jumlah like pada jawaban komunitas berdasarkan ID jawaban."
      parameters:
        - name: id
          in: path
          required: true
          type: integer
          description: "ID dari jawaban komunitas yang ingin disukai (like)."
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token untuk otorisasi (e.g., 'Bearer <access_token>')."
      responses:
        200:
          description: "Berhasil menyukai jawaban komunitas."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Sukses menyukai (like) jawaban dari pertanyaan komunitas."
        400:
          description: "Jawaban tidak ditemukan."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Gagal menyukai (like) jawaban dari pertanyaan komunitas."
        500:
          description: "Kesalahan server internal."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Error terjadi"
              error:
                type: string
                example: "Database connection failed."

  /community/answer/{id}/dislike/:
    post:
      tags:
        - "community"
      summary: "Tidak menyukai (dislike) jawaban komunitas"
      description: "Mengurangi jumlah like pada jawaban komunitas berdasarkan ID jawaban."
      parameters:
        - name: id
          in: path
          required: true
          type: integer
          description: "ID dari jawaban komunitas yang ingin tidak disukai (dislike)."
        - name: Authorization
          in: header
          required: true
          type: string
          description: "JWT token untuk otorisasi (e.g., 'Bearer <access_token>')."
      responses:
        200:
          description: "Berhasil tidak menyukai jawaban komunitas."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Sukses tidak menyukai (dislike) jawaban dari pertanyaan komunitas."
        400:
          description: "Jawaban tidak ditemukan atau like bernilai 0."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Gagal tidak menyukai (dislike) jawaban dari pertanyaan komunitas."
        500:
          description: "Kesalahan server internal."
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Error terjadi"
              error:
                type: string
                example: "Database connection failed."

